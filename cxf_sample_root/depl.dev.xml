<?xml version="1.0" encoding="UTF-8"?>
<project name="cxf-sample" default="start-deploy-all">

    <property name="karaf.home" location="d:/apache/apache-karaf-3.0.5"/>
    <property name="karaf.deploy" location="${karaf.home}/deploy"/>
    <property name="depl-all.script" value="d:/projects/research/sample_cxf/cxf_sample_root/depl-all"/>
    <property name="depl-rs.script" value="d:/projects/research/sample_cxf/cxf_sample_root/depl-rs"/>
    <property name="depl-ws.script" value="d:/projects/research/sample_cxf/cxf_sample_root/depl-ws"/>

    <target name="karaf-start-clean">
        <delete dir="${karaf.deploy}" includes="*"/>
        <exec executable="cmd.exe" spawn="yes" osfamily="windows">
            <arg line='/c start /MIN ${karaf.home}/bin/karaf.bat clean debug ^&amp; exit'/>
        </exec>
    </target>

    <target name="karaf-start-restore">
        <exec executable="cmd.exe" spawn="yes" osfamily="windows">
            <arg line='/c start /MIN ${karaf.home}/bin/karaf.bat debug ^&amp; exit'/>
        </exec>
    </target>

    <target name="karaf-shutdown">
        <karaf-exec-client command="shutdown -f"/>
    </target>

    <target name="deploy-all">
        <karaf-exec-client command="shell:source ${depl-all.script}"/>
    </target>

    <target name="deploy-rs">
        <karaf-exec-client command="shell:source ${depl-rs.script}"/>
    </target>

    <target name="deploy-ws">
        <karaf-exec-client command="shell:source ${depl-ws.script}"/>
    </target>

    <target name="start-deploy-all" depends="karaf-start-clean">
        <!--<sleep seconds="8"/>-->
        <!--<karaf-execute command="shell:source ${depl.script}"/>-->
        <karaf-exec-client command="shell:source ${depl-all.script}"/>
    </target>

    <macrodef name="karaf-exec-client">
        <attribute name="command"/>
        <sequential>
            <echo>@{command}</echo>
            <exec executable="${karaf.home}/bin/client.bat" spawn="true" osfamily="windows">
                <arg line='-a 8101 -h localhost -u karaf -r 10 "@{command}"'/>
            </exec>
        </sequential>
    </macrodef>

</project>